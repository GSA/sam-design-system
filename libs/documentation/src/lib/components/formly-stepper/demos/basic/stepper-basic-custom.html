<div class="grid-row">
  <div class="desktop:grid-col-4 tablet-lg:grid-col-12 mobile-lg:grid-col-12 margin-bottom-3 margin-right-2">
    <div class="sds-card">
      <div class="sds-card__body sds-card__body--accent-cool">

        <ul class="usa-sidenav usa-sidenav--styled">
          <li *ngFor="let step of stepTemplates; let i = index;" class="usa-sidenav__item"
            [ngClass]="{
              'usa-current':  _currentStep?.id === step.id
            }">
            <ng-container [ngTemplateOutlet]="sidenavItem" [ngTemplateOutletContext]="{$implicit: step}">
            </ng-container>
            <ng-container [ngTemplateOutlet]="subPanelTemplate" [ngTemplateOutletContext]="{$implicit:step}">
            </ng-container>
          </li>
        </ul>
      </div>
    </div>
  </div>
  <div class="grid-col-fill">
    <div [ngTemplateOutlet]="_currentStep ? _currentStep.content : null"></div>
    <div class="grid-row grid-gap flex-justify-center margin-top-4">
      <button sdsStepperPrevious class="usa-button sds-button--circle usa-button--base usa-button--big padding-2 margin-right-2">
        <sds-icon [icon]="'chevron-left'"></sds-icon>
      </button>

      <button class="usa-button sds-button--circle usa-button--big usa-button--base padding-2 margin-right-2">
        <sds-icon [icon]="'x'"></sds-icon>
      </button>

      <button class="usa-button sds-button--circle usa-button--big usa-button--base padding-2 margin-right-2">
        <sds-icon [icon]="'question'"></sds-icon>
      </button>

      <button sdsStepperSave class="usa-button sds-button--circle usa-button--base usa-button--big padding-2 margin-right-2">
        <sds-icon [icon]="'save'"></sds-icon>
      </button>

      <button sdsStepperNext class="usa-button sds-button--circle usa-button--base usa-button--big padding-2 margin-right-2">
        <sds-icon [icon]="'chevron-right'"></sds-icon>
      </button>
    </div>
  </div>
</div>

<ng-template #subPanelTemplate let-panelItem>
  <div *ngFor="let pItem of getDisplayedSteps(panelItem.children); let i = index;">
    <ul class="usa-sidenav usa-sidenav--styled bg-base-lighter margin-x-0">
      <li class="usa-sidenav__item  padding-left-3" [ngClass]="{'usa-current':  _currentStep?.id === pItem.id }">
        <ng-container [ngTemplateOutlet]="sidenavItem" [ngTemplateOutletContext]="{$implicit: pItem}"></ng-container>
      </li>
    </ul>
  </div>
</ng-template>

<ng-template #sidenavItem let-step>
  <ng-container [ngSwitch]="step.mode">
    <span *ngSwitchCase="navigationMode.LABEL">
      <span class="margin-left-1 padding-x-2 padding-y-1 display-block text-bold">
        {{step.text}}
      </span>
    </span>
    <a *ngSwitchDefault href="javascript:void(0);" [sdsStepperNav]="step.id">
      <span>
        {{step.text}}
      </span>
      <ng-container [ngTemplateOutlet]="sidenavIcon" [ngTemplateOutletContext]="{$implicit: step}"></ng-container>
    </a>
  </ng-container>
</ng-template>

<ng-template #sidenavIcon let-step>
  <span class="float-right">
    <ng-container [ngSwitch]="step.valid">
      <sds-icon *ngSwitchCase="true" [icon]="'check-circle-fill'" class="text-primary"></sds-icon>
      <sds-icon *ngSwitchCase="false" [icon]="'slash-circle-fill'" class="text-error"></sds-icon>
      <sds-icon *ngSwitchDefault [icon]="'circle'"></sds-icon>
    </ng-container>
  </span>
</ng-template> 