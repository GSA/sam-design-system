<!-- Vertical Filters -->
<div *ngIf="!horizontal">
  <formly-form [form]="form" [fields]="fields" [options]="options" [model]="model" (modelChange)="onModelChange($event)">
  </formly-form>
  <div class="grid-row margin-top-2">
    <div *ngIf="advancedFilters" class="grid-col">
      <sds-advanced-filters [form]="form" [sortMoreFilterBy]="sortMoreFilterBy" [fields]="fields" [options]="options"
        [model]="model" (showInactiveFiltersChange)="showInactiveFiltersChange.next($event)" [isInactiveValueFieldShown]=isInactiveValueFieldShown>
      </sds-advanced-filters>
    </div>
    <div class="grid-col text-right">
      <sds-formly-reset [options]="options" [defaultModel]="defaultModel"></sds-formly-reset>
    </div>
  </div>
</div>

<!-- Horizontal Filters -->
<div *ngIf="horizontal && !dialogRef" class="sds-filters--horizontal">
  <div class="horizontal-filters grid-row">
    <formly-form [form]="form" [fields]="fields" [options]="options" [model]="model" (modelChange)="onModelChange($event)">
    </formly-form>
    <div *ngIf="advancedFilters">
      <sds-advanced-filters [form]="form" [sortMoreFilterBy]="sortMoreFilterBy" [fields]="fields" 
        [options]="options" [model]="model" [isInactiveValueFieldShown]="isInactiveValueFieldShown"
        [enablePopover]="horizontal"
        (showInactiveFiltersChange)="handleInactiveFilterChange($event)" >
      </sds-advanced-filters>
    </div>
  </div>


  <div class="search-input">
    <ng-content select="sds-search"></ng-content>
  </div>

  <div class="filters-modal">
    <button *ngIf="!enablePopover" type="button" (click)="openDialog()" class="usa-button usa-button--unstyled">
      Filter By
      <usa-icon [icon]="'filter'" class="icon-filter" [size]="'sm'"></usa-icon>
    </button>
  </div>

  <div *ngIf="showReset" class="horizontal-reset grid-col text-right">
    <sds-formly-reset [options]="options" [defaultModel]="{}"></sds-formly-reset>
  </div>
</div>

<!-- Chip Display -->
<ng-container *ngIf="displayChips">
  <div *ngFor="let chip of chips" class="width-auto sds-tag sds-tag--chip sds-tag--input margin-right-2 ">
    <div class="sds--tag__item">
      <sds-readonly-container
        [label]="chip.label"
        [value]="chip.value"
        [additionalConfig]="chip.readonlyOptions"
        [formlyType]="chip.formlyType"
      >
        <ng-container *sdsReadonlyLabel><span class="margin-right-1 text-bold">{{chip.label}}:</span></ng-container>
        <ng-container *sdsReadonlyValue="let value"><span class="margin-right-1">{{value}}</span></ng-container>
      </sds-readonly-container>
    </div>
    <button [attr.aria-label]="'Remove Item ' + chip.label + ' ' + chip.value"
      aria-hidden="false" class="sds-tag__close position-static"
      (click)="removeChip(chip)"
      (keyup.enter)="removeChip(chip)">
      <usa-icon [icon]="'x'" size="lg"></usa-icon>
    </button>
  </div>
</ng-container>

<ng-template #horizontalFiltersDialog let-data>
  <div class="padding-4">
    <formly-form [form]="form" [fields]="data.fields" [options]="data.options" [model]="model" (modelChange)="_pendingFilterValue = $event">
    </formly-form>
    <div class="grid-row margin-top-2">
      <div class="grid-col text-right">
        <sds-formly-reset [options]="data.options" [defaultModel]="{}"></sds-formly-reset>
      </div>
    </div>
    <button class="usa-button" (click)="applyDialogFilters()">Apply</button>
    <button class="usa-button usa-button--base" (click)="close()">Close</button>
  </div>
</ng-template>
